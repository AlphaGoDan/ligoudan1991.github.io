let jqPlugInInit = ajax => {
  /**
   * 处理图片的显示比例问题
   */
  $.fn.responseImg = function () {
    if (this.length === 0) {
      return this;
    }

    return this.each(function () {
      let $this = $(this);
      let $mImg = $this.find('img');
      let img = $mImg[0];
      let boxRatio = $this.width() / $this.height();
      let maxTime = 3;

      let _fn = () => {
        maxTime--;

        if (img.complete || maxTime === 0) {
          let imgRatio = img.width / img.height;

          if (imgRatio > boxRatio) {
            $this.addClass('h');
          }

          return;
        }

        setTimeout(function () {
          _fn();
        }, 600);
      };

      _fn();

      return this;
    });
  };
  /**
   * 加载更多组件
   * @param option 中的参数如下:
   * url : 数据请求的url
   * templateId : 模版id
   * urlOp : url参数
   */


  $.fn.pageAddMore = function (option = {}) {
    if (this.length === 0) {
      return this;
    }

    return this.each(function () {
      let $this = $(this);
      let url = option.url || $this.data('url');
      let templateId = $this.data('template') || option.template;
      let urlOp = $.extend({
        page_num: 0
      }, option.urlOption, $this.data('url-op'));
      let $addMore = $('<a class="m-more j-more hasMore">点击加载更多</a>');
      $this.after($addMore);
      $addMore.click(function () {
        let $clickThis = $(this);

        if (!$clickThis.hasClass('hasMore')) {
          return;
        }

        urlOp.page_num++;
        $clickThis.text('').addClass('load');
        ajax.get(url, urlOp).then(data => {
          if (data.data.length === 0) {
            $clickThis.text('没有更多了').removeClass('hasMore load');
            return;
          }

          $clickThis.text('点击加载更多').removeClass('load');
          $this.append(pugHtml(templateId, data));
          $this.find('.f-imgBt').responseImg();
        }).catch(err => {
          console.error('加载更多错误 ', err);
        });
      });
      return this;
    });
  };
  /**
   * 联动选择组件
   * @param option
   * @param urlOption
   */


  $.fn.gangedSelect = function (option = {}) {
    if (this.length !== 1) {
      return this;
    }

    let $this = $(this);
    let $open = $this.find('.j-open'); //折叠开关

    let $screen = $('.j-screen'); //选项

    let $ops = $screen.find('.j-option'); //子选项

    let $content = $this.find('.j-content'); //内容插入位置

    let $addMore = $this.find('.j-more'); //加载更多

    let templateId = option.template || $this.data('template');
    let url = option.url || $this.data('url');
    let urlOp = option.urlOp || $this.data('url-op');
    let screenOn = {};
    let $screenOns = $this.find('.j-screenOn .j-option');

    for (let i = 0; i < $screenOns.length; i++) {
      let $screenOnThis = $screenOns.eq(i);
      screenOn[$screenOnThis.data('type')] = $screenOnThis;
    }

    $open.click(function () {
      $open.toggleClass('on');
      $screen.stop().slideToggle(500);

      if ($open.hasClass('on')) {
        $open.text('关闭筛选');
      } else {
        $open.text('打开筛选');
      }
    });
    $ops.click(function () {
      let $clickThis = $(this);

      if ($clickThis.hasClass('on')) {
        return;
      }

      $clickThis.addClass('on').siblings().removeClass('on');
      let type = $clickThis.data('type');
      let state = $clickThis.data('state');
      screenOn[type].text($clickThis.text());

      if (typeof state === 'object') {
        urlOp = Object.assign(urlOp, state);
      } else {
        urlOp[type] = state;
      }

      urlOp.page_num = 0;
      ajax.get(url, urlOp).then(data => {
        $addMore.addClass('hasMore').text('点击加载更多');
        $content.html(pugHtml(templateId, data));
      }).catch(err => {
        console.error('gangedSelect ', err);
      });
    });
    $addMore.click(function () {
      if (!$addMore.hasClass('hasMore')) {
        return;
      }

      urlOp.page_num = urlOp.page_num + 1;
      $addMore.text('').addClass('load');
      ajax.get(url, urlOp).then(data => {
        if (data.data.length === 0) {
          $addMore.text('没有更多了').removeClass('hasMore load');
          return;
        }

        $addMore.text('点击加载更多').removeClass('load');
        $content.append(pugHtml(templateId, data));
        $content.find('.f-imgBt').responseImg();
      }).catch(err => {
        console.error('gangedSelect addMore ', err);
      });
    });
    return this;
  };
  /**
   * tab切换
   * @return {$}
   */


  $.fn.tabChange = function () {
    if (this.length === 0) {
      return this;
    }

    return this.click(function () {
      let $this = $(this);
      let $tab = $('[data-tab=' + $this.data('tab') + ']');
      $this.addClass('on').siblings().removeClass('on');
      $tab.addClass('on').siblings().removeClass('on');
      return this;
    });
  };
  /**
   * 图片 鼠标mouseOver 时放大
   * @return {*}
   */


  $.fn.mouseOverZoomIn = function () {
    if (this.length === 0) {
      return this;
    }

    return this.mouseover(function () {
      let $this = $(this);
      $this.addClass('on').siblings().removeClass('on');
      $this.find('.f-imgBt').responseImg();
      return this;
    });
  };
  /**
   * 侧边导航定位对齐
   * @return {*}
   */


  $.fn.navPosition = function () {
    if (this.length === 0) {
      return this;
    }

    return this.click(function () {
      let $this = $(this);
      let navItem = $('.j-navItem');
      let index = $this.index();
      let offsetTop = navItem.eq(index).offset().top - 80;
      $('body,html').animate({
        scrollTop: offsetTop
      }, 200, 'linear');
      return this;
    });
  };
  /**
   * 固定表头
   */


  $.fn.fixedHead = function () {
    if (this.length === 0) {
      return this;
    }

    if (this.length > 1) {
      throw new Error('固定表头只能有一个');
    }

    let $this = $(this);
    let $gBody = $('.g-bd');
    let offsetTop = $this.offset().top;

    $gBody[0].onscroll = function () {
      let scrollTop = $gBody.scrollTop();

      if (scrollTop >= offsetTop) {
        $this.addClass('fixed');
      } else {
        $this.removeClass('fixed');
      }
    };
  };
  /**
   * 绑定页面中的分享模块,带复制链接
   */


  $.fn.shareLink = function (option) {
    if (this.length === 0) {
      return this;
    }

    let url = window.location.href;
    let defaultOp = {
      eventType: 'click',
      container: '#qr-code',
      url: url,
      //复制黏贴的url
      qrcodeUrl: url,
      //二维码url
      width: 80,
      height: 80,
      callback: function () {}
    };
    let $mod = $('.j-mod-share');
    let $copyUrl = $('.j-copy-url');
    let op = Object.assign(defaultOp, option);
    let eventType = op.eventType;
    $(op.container).qrcode({
      width: op.width,
      height: op.height,
      text: op.qrcodeUrl,
      typeNumber: 0,
      correctLevel: 1
    });
    $(document).click(function () {
      $mod.removeClass('on');
    });
    $copyUrl.click(function () {
      let aux = document.createElement('input');
      aux.setAttribute('value', op.url);
      document.body.appendChild(aux);
      aux.select();
      document.execCommand('copy'); // 执行复制命令

      document.body.removeChild(aux); // 将 input 元素移除

      if (typeof op.callback === 'function') {
        op.callback();
      }
    });

    if (eventType === 'hover') {
      return this.hover(function () {
        $mod.toggleClass('on');
      }, function () {
        $mod.removeClass('on');
      });
    }

    return this.click(function (e) {
      $mod.toggleClass('on');
      e.stopPropagation();
    });
  };
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxLXBsdWdpbi5lczYiXSwibmFtZXMiOlsianFQbHVnSW5Jbml0IiwiYWpheCIsIiQiLCJmbiIsInJlc3BvbnNlSW1nIiwibGVuZ3RoIiwiZWFjaCIsIiR0aGlzIiwiJG1JbWciLCJmaW5kIiwiaW1nIiwiYm94UmF0aW8iLCJ3aWR0aCIsImhlaWdodCIsIm1heFRpbWUiLCJfZm4iLCJjb21wbGV0ZSIsImltZ1JhdGlvIiwiYWRkQ2xhc3MiLCJzZXRUaW1lb3V0IiwicGFnZUFkZE1vcmUiLCJvcHRpb24iLCJ1cmwiLCJkYXRhIiwidGVtcGxhdGVJZCIsInRlbXBsYXRlIiwidXJsT3AiLCJleHRlbmQiLCJwYWdlX251bSIsInVybE9wdGlvbiIsIiRhZGRNb3JlIiwiYWZ0ZXIiLCJjbGljayIsIiRjbGlja1RoaXMiLCJoYXNDbGFzcyIsInRleHQiLCJnZXQiLCJ0aGVuIiwicmVtb3ZlQ2xhc3MiLCJhcHBlbmQiLCJwdWdIdG1sIiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJnYW5nZWRTZWxlY3QiLCIkb3BlbiIsIiRzY3JlZW4iLCIkb3BzIiwiJGNvbnRlbnQiLCJzY3JlZW5PbiIsIiRzY3JlZW5PbnMiLCJpIiwiJHNjcmVlbk9uVGhpcyIsImVxIiwidG9nZ2xlQ2xhc3MiLCJzdG9wIiwic2xpZGVUb2dnbGUiLCJzaWJsaW5ncyIsInR5cGUiLCJzdGF0ZSIsIk9iamVjdCIsImFzc2lnbiIsImh0bWwiLCJ0YWJDaGFuZ2UiLCIkdGFiIiwibW91c2VPdmVyWm9vbUluIiwibW91c2VvdmVyIiwibmF2UG9zaXRpb24iLCJuYXZJdGVtIiwiaW5kZXgiLCJvZmZzZXRUb3AiLCJvZmZzZXQiLCJ0b3AiLCJhbmltYXRlIiwic2Nyb2xsVG9wIiwiZml4ZWRIZWFkIiwiRXJyb3IiLCIkZ0JvZHkiLCJvbnNjcm9sbCIsInNoYXJlTGluayIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsImRlZmF1bHRPcCIsImV2ZW50VHlwZSIsImNvbnRhaW5lciIsInFyY29kZVVybCIsImNhbGxiYWNrIiwiJG1vZCIsIiRjb3B5VXJsIiwib3AiLCJxcmNvZGUiLCJ0eXBlTnVtYmVyIiwiY29ycmVjdExldmVsIiwiZG9jdW1lbnQiLCJhdXgiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiYm9keSIsImFwcGVuZENoaWxkIiwic2VsZWN0IiwiZXhlY0NvbW1hbmQiLCJyZW1vdmVDaGlsZCIsImhvdmVyIiwiZSIsInN0b3BQcm9wYWdhdGlvbiJdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSUEsWUFBWSxHQUFJQyxJQUFELElBQVU7QUFDekI7OztBQUdBQyxFQUFBQSxDQUFDLENBQUNDLEVBQUYsQ0FBS0MsV0FBTCxHQUFtQixZQUFXO0FBQzFCLFFBQUksS0FBS0MsTUFBTCxLQUFnQixDQUFwQixFQUF1QjtBQUNuQixhQUFPLElBQVA7QUFDSDs7QUFDRCxXQUFPLEtBQUtDLElBQUwsQ0FBVSxZQUFXO0FBQ3hCLFVBQUlDLEtBQUssR0FBR0wsQ0FBQyxDQUFDLElBQUQsQ0FBYjtBQUNBLFVBQUlNLEtBQUssR0FBR0QsS0FBSyxDQUFDRSxJQUFOLENBQVcsS0FBWCxDQUFaO0FBQ0EsVUFBSUMsR0FBRyxHQUFHRixLQUFLLENBQUMsQ0FBRCxDQUFmO0FBQ0EsVUFBSUcsUUFBUSxHQUFHSixLQUFLLENBQUNLLEtBQU4sS0FBZ0JMLEtBQUssQ0FBQ00sTUFBTixFQUEvQjtBQUNBLFVBQUlDLE9BQU8sR0FBRyxDQUFkOztBQUNBLFVBQUlDLEdBQUcsR0FBRyxNQUFNO0FBQ1pELFFBQUFBLE9BQU87O0FBQ1AsWUFBSUosR0FBRyxDQUFDTSxRQUFKLElBQWdCRixPQUFPLEtBQUssQ0FBaEMsRUFBbUM7QUFDL0IsY0FBSUcsUUFBUSxHQUFHUCxHQUFHLENBQUNFLEtBQUosR0FBWUYsR0FBRyxDQUFDRyxNQUEvQjs7QUFDQSxjQUFJSSxRQUFRLEdBQUdOLFFBQWYsRUFBeUI7QUFDckJKLFlBQUFBLEtBQUssQ0FBQ1csUUFBTixDQUFlLEdBQWY7QUFDSDs7QUFDRDtBQUNIOztBQUNE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QUFDdkIsYUFBTyxLQUFLbUIsS0FBTCxDQUNILFlBQVc7QUFDUGYsUUFBQUEsSUFBSSxDQUFDbEMsV0FBTCxDQUFpQixJQUFqQjtBQUNILE9BSEUsRUFJSCxZQUFXO0FBQ1BrQyxRQUFBQSxJQUFJLENBQUNuRCxXQUFMLENBQWlCLElBQWpCO0FBQ0gsT0FORSxDQUFQO0FBUUg7O0FBQ0csV0FBTyxLQUFLTixLQUFMLENBQVcsVUFBU3lFLENBQVQsRUFBWTtBQUMxQmhCLE1BQUFBLElBQUksQ0FBQ2xDLFdBQUwsQ0FBaUIsSUFBakI7QUFDQWtELE1BQUFBLENBQUMsQ0FBQ0MsZUFBRjtBQUNILEtBSE0sQ0FBUDtBQUtQLEdBdEREO0FBdURILENBblNEIiwic291cmNlc0NvbnRlbnQiOlsibGV0IGpxUGx1Z0luSW5pdCA9IChhamF4KSA9PiB7XG4gICAgLyoqXG4gICAgICog5aSE55CG5Zu+54mH55qE5pi+56S65q+U5L6L6Zeu6aKYXG4gICAgICovXG4gICAgJC5mbi5yZXNwb25zZUltZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsZXQgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgbGV0ICRtSW1nID0gJHRoaXMuZmluZCgnaW1nJyk7XG4gICAgICAgICAgICBsZXQgaW1nID0gJG1JbWdbMF07XG4gICAgICAgICAgICBsZXQgYm94UmF0aW8gPSAkdGhpcy53aWR0aCgpIC8gJHRoaXMuaGVpZ2h0KCk7XG4gICAgICAgICAgICBsZXQgbWF4VGltZSA9IDM7XG4gICAgICAgICAgICBsZXQgX2ZuID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIG1heFRpbWUtLTtcbiAgICAgICAgICAgICAgICBpZiAoaW1nLmNvbXBsZXRlIHx8IG1heFRpbWUgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGltZ1JhdGlvID0gaW1nLndpZHRoIC8gaW1nLmhlaWdodDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGltZ1JhdGlvID4gYm94UmF0aW8pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmFkZENsYXNzKCdoJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBfZm4oKTtcbiAgICAgICAgICAgICAgICB9LCA2MDApO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIF9mbigpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICog5Yqg6L295pu05aSa57uE5Lu2XG4gICAgICogQHBhcmFtIG9wdGlvbiDkuK3nmoTlj4LmlbDlpoLkuIs6XG4gICAgICogdXJsIDog5pWw5o2u6K+35rGC55qEdXJsXG4gICAgICogdGVtcGxhdGVJZCA6IOaooeeJiGlkXG4gICAgICogdXJsT3AgOiB1cmzlj4LmlbBcbiAgICAgKi9cbiAgICAkLmZuLnBhZ2VBZGRNb3JlID0gZnVuY3Rpb24ob3B0aW9uID0ge30pIHtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbGV0ICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgIGxldCB1cmwgPSBvcHRpb24udXJsIHx8ICR0aGlzLmRhdGEoJ3VybCcpO1xuICAgICAgICAgICAgbGV0IHRlbXBsYXRlSWQgPSAkdGhpcy5kYXRhKCd0ZW1wbGF0ZScpIHx8IG9wdGlvbi50ZW1wbGF0ZTtcbiAgICAgICAgICAgIGxldCB1cmxPcCA9ICQuZXh0ZW5kKHsgcGFnZV9udW06IDAgfSwgb3B0aW9uLnVybE9wdGlvbiwgJHRoaXMuZGF0YSgndXJsLW9wJykpO1xuXG4gICAgICAgICAgICBsZXQgJGFkZE1vcmUgPSAkKCc8YSBjbGFzcz1cIm0tbW9yZSBqLW1vcmUgaGFzTW9yZVwiPueCueWHu+WKoOi9veabtOWkmjwvYT4nKTtcbiAgICAgICAgICAgICR0aGlzLmFmdGVyKCRhZGRNb3JlKTtcbiAgICAgICAgICAgICRhZGRNb3JlLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGxldCAkY2xpY2tUaGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAoISRjbGlja1RoaXMuaGFzQ2xhc3MoJ2hhc01vcmUnKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHVybE9wLnBhZ2VfbnVtKys7XG4gICAgICAgICAgICAgICAgJGNsaWNrVGhpcy50ZXh0KCcnKS5hZGRDbGFzcygnbG9hZCcpO1xuICAgICAgICAgICAgICAgIGFqYXguZ2V0KHVybCwgdXJsT3ApXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YS5kYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjbGlja1RoaXMudGV4dCgn5rKh5pyJ5pu05aSa5LqGJykucmVtb3ZlQ2xhc3MoJ2hhc01vcmUgbG9hZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICRjbGlja1RoaXMudGV4dCgn54K55Ye75Yqg6L295pu05aSaJykucmVtb3ZlQ2xhc3MoJ2xvYWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmFwcGVuZChwdWdIdG1sKHRlbXBsYXRlSWQsIGRhdGEpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoJy5mLWltZ0J0JykucmVzcG9uc2VJbWcoKTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+WKoOi9veabtOWkmumUmeivryAnLCBlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICog6IGU5Yqo6YCJ5oup57uE5Lu2XG4gICAgICogQHBhcmFtIG9wdGlvblxuICAgICAqIEBwYXJhbSB1cmxPcHRpb25cbiAgICAgKi9cbiAgICAkLmZuLmdhbmdlZFNlbGVjdCA9IGZ1bmN0aW9uKG9wdGlvbiA9IHt9KSB7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgbGV0ICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgbGV0ICRvcGVuID0gJHRoaXMuZmluZCgnLmotb3BlbicpOyAvL+aKmOWPoOW8gOWFs1xuICAgICAgICBsZXQgJHNjcmVlbiA9ICQoJy5qLXNjcmVlbicpOyAvL+mAiemhuVxuICAgICAgICBsZXQgJG9wcyA9ICRzY3JlZW4uZmluZCgnLmotb3B0aW9uJyk7IC8v5a2Q6YCJ6aG5XG4gICAgICAgIGxldCAkY29udGVudCA9ICR0aGlzLmZpbmQoJy5qLWNvbnRlbnQnKTsgLy/lhoXlrrnmj5LlhaXkvY3nva5cbiAgICAgICAgbGV0ICRhZGRNb3JlID0gJHRoaXMuZmluZCgnLmotbW9yZScpOyAvL+WKoOi9veabtOWkmlxuXG4gICAgICAgIGxldCB0ZW1wbGF0ZUlkID0gb3B0aW9uLnRlbXBsYXRlIHx8ICR0aGlzLmRhdGEoJ3RlbXBsYXRlJyk7XG4gICAgICAgIGxldCB1cmwgPSBvcHRpb24udXJsIHx8ICR0aGlzLmRhdGEoJ3VybCcpO1xuICAgICAgICBsZXQgdXJsT3AgPSBvcHRpb24udXJsT3AgfHwgJHRoaXMuZGF0YSgndXJsLW9wJyk7XG4gICAgICAgIGxldCBzY3JlZW5PbiA9IHt9O1xuICAgICAgICBsZXQgJHNjcmVlbk9ucyA9ICR0aGlzLmZpbmQoJy5qLXNjcmVlbk9uIC5qLW9wdGlvbicpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8ICRzY3JlZW5PbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGxldCAkc2NyZWVuT25UaGlzID0gJHNjcmVlbk9ucy5lcShpKTtcbiAgICAgICAgICAgIHNjcmVlbk9uWyRzY3JlZW5PblRoaXMuZGF0YSgndHlwZScpXSA9ICRzY3JlZW5PblRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgJG9wZW4uY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkb3Blbi50b2dnbGVDbGFzcygnb24nKTtcbiAgICAgICAgICAgICRzY3JlZW4uc3RvcCgpLnNsaWRlVG9nZ2xlKDUwMCk7XG4gICAgICAgICAgICBpZiAoJG9wZW4uaGFzQ2xhc3MoJ29uJykpIHtcbiAgICAgICAgICAgICAgICAkb3Blbi50ZXh0KCflhbPpl63nrZvpgIknKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJG9wZW4udGV4dCgn5omT5byA562b6YCJJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAkb3BzLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbGV0ICRjbGlja1RoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgaWYgKCRjbGlja1RoaXMuaGFzQ2xhc3MoJ29uJykpIHtyZXR1cm47fVxuICAgICAgICAgICAgJGNsaWNrVGhpc1xuICAgICAgICAgICAgICAgIC5hZGRDbGFzcygnb24nKVxuICAgICAgICAgICAgICAgIC5zaWJsaW5ncygpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdvbicpO1xuICAgICAgICAgICAgbGV0IHR5cGUgPSAkY2xpY2tUaGlzLmRhdGEoJ3R5cGUnKTtcbiAgICAgICAgICAgIGxldCBzdGF0ZSA9ICRjbGlja1RoaXMuZGF0YSgnc3RhdGUnKTtcbiAgICAgICAgICAgIHNjcmVlbk9uW3R5cGVdLnRleHQoJGNsaWNrVGhpcy50ZXh0KCkpO1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICB1cmxPcCA9IE9iamVjdC5hc3NpZ24odXJsT3AsIHN0YXRlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdXJsT3BbdHlwZV0gPSBzdGF0ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHVybE9wLnBhZ2VfbnVtID0gMDtcbiAgICAgICAgICAgIGFqYXguZ2V0KHVybCwgdXJsT3ApXG4gICAgICAgICAgICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgJGFkZE1vcmUuYWRkQ2xhc3MoJ2hhc01vcmUnKS50ZXh0KCfngrnlh7vliqDovb3mm7TlpJonKTtcbiAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnQuaHRtbChwdWdIdG1sKHRlbXBsYXRlSWQsIGRhdGEpKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2dhbmdlZFNlbGVjdCAnLCBlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgJGFkZE1vcmUuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoISRhZGRNb3JlLmhhc0NsYXNzKCdoYXNNb3JlJykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB1cmxPcC5wYWdlX251bSA9IHVybE9wLnBhZ2VfbnVtICsgMTtcbiAgICAgICAgICAgICRhZGRNb3JlLnRleHQoJycpLmFkZENsYXNzKCdsb2FkJyk7XG4gICAgICAgICAgICBhamF4LmdldCh1cmwsIHVybE9wKVxuICAgICAgICAgICAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmRhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkYWRkTW9yZS50ZXh0KCfmsqHmnInmm7TlpJrkuoYnKS5yZW1vdmVDbGFzcygnaGFzTW9yZSBsb2FkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJGFkZE1vcmUudGV4dCgn54K55Ye75Yqg6L295pu05aSaJykucmVtb3ZlQ2xhc3MoJ2xvYWQnKTtcbiAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnQuYXBwZW5kKHB1Z0h0bWwodGVtcGxhdGVJZCwgZGF0YSkpO1xuICAgICAgICAgICAgICAgICAgICAkY29udGVudC5maW5kKCcuZi1pbWdCdCcpLnJlc3BvbnNlSW1nKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdnYW5nZWRTZWxlY3QgYWRkTW9yZSAnLCBlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiB0YWLliIfmjaJcbiAgICAgKiBAcmV0dXJuIHskfVxuICAgICAqL1xuICAgICQuZm4udGFiQ2hhbmdlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsZXQgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgbGV0ICR0YWIgPSAkKCdbZGF0YS10YWI9JyArICR0aGlzLmRhdGEoJ3RhYicpICsgJ10nKTtcbiAgICAgICAgICAgICR0aGlzXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKCdvbicpXG4gICAgICAgICAgICAgICAgLnNpYmxpbmdzKClcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ29uJyk7XG4gICAgICAgICAgICAkdGFiLmFkZENsYXNzKCdvbicpXG4gICAgICAgICAgICAgICAgLnNpYmxpbmdzKClcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ29uJyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDlm77niYcg6byg5qCHbW91c2VPdmVyIOaXtuaUvuWkp1xuICAgICAqIEByZXR1cm4geyp9XG4gICAgICovXG4gICAgJC5mbi5tb3VzZU92ZXJab29tSW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5tb3VzZW92ZXIoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsZXQgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgJHRoaXNcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ29uJylcbiAgICAgICAgICAgICAgICAuc2libGluZ3MoKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnb24nKTtcbiAgICAgICAgICAgICR0aGlzLmZpbmQoJy5mLWltZ0J0JykucmVzcG9uc2VJbWcoKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOS+p+i+ueWvvOiIquWumuS9jeWvuem9kFxuICAgICAqIEByZXR1cm4geyp9XG4gICAgICovXG4gICAgJC5mbi5uYXZQb3NpdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbGV0ICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgIGxldCBuYXZJdGVtID0gJCgnLmotbmF2SXRlbScpO1xuICAgICAgICAgICAgbGV0IGluZGV4ID0gJHRoaXMuaW5kZXgoKTtcbiAgICAgICAgICAgIGxldCBvZmZzZXRUb3AgPSBuYXZJdGVtLmVxKGluZGV4KS5vZmZzZXQoKS50b3AgLSA4MDtcbiAgICAgICAgICAgICQoJ2JvZHksaHRtbCcpLmFuaW1hdGUoeyBzY3JvbGxUb3A6IG9mZnNldFRvcCB9LCAyMDAsICdsaW5lYXInKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIOWbuuWumuihqOWktFxuICAgICAqL1xuICAgICQuZm4uZml4ZWRIZWFkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCflm7rlrprooajlpLTlj6rog73mnInkuIDkuKonKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICBsZXQgJGdCb2R5ID0gJCgnLmctYmQnKTtcbiAgICAgICAgbGV0IG9mZnNldFRvcCA9ICR0aGlzLm9mZnNldCgpLnRvcDtcbiAgICAgICAgJGdCb2R5WzBdLm9uc2Nyb2xsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsZXQgc2Nyb2xsVG9wID0gJGdCb2R5LnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgaWYgKHNjcm9sbFRvcCA+PSBvZmZzZXRUb3ApIHtcbiAgICAgICAgICAgICAgICAkdGhpcy5hZGRDbGFzcygnZml4ZWQnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHRoaXMucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiDnu5HlrprpobXpnaLkuK3nmoTliIbkuqvmqKHlnZcs5bim5aSN5Yi26ZO+5o6lXG4gICAgICovXG4gICAgJC5mbi5zaGFyZUxpbmsgPSBmdW5jdGlvbihvcHRpb24pIHtcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICBsZXQgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gICAgICAgIGxldCBkZWZhdWx0T3AgPSB7XG4gICAgICAgICAgICBldmVudFR5cGU6ICdjbGljaycsXG4gICAgICAgICAgICBjb250YWluZXI6ICcjcXItY29kZScsXG4gICAgICAgICAgICB1cmw6IHVybCwgLy/lpI3liLbpu4/otLTnmoR1cmxcbiAgICAgICAgICAgIHFyY29kZVVybDogdXJsLCAvL+S6jOe7tOeggXVybFxuICAgICAgICAgICAgd2lkdGg6IDgwLFxuICAgICAgICAgICAgaGVpZ2h0OiA4MCxcbiAgICAgICAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbigpIHt9XG4gICAgICAgIH07XG4gICAgICAgIGxldCAkbW9kID0gJCgnLmotbW9kLXNoYXJlJyk7XG4gICAgICAgIGxldCAkY29weVVybCA9ICQoJy5qLWNvcHktdXJsJyk7XG4gICAgICAgIGxldCBvcCA9IE9iamVjdC5hc3NpZ24oZGVmYXVsdE9wLCBvcHRpb24pO1xuICAgICAgICBsZXQgZXZlbnRUeXBlID0gb3AuZXZlbnRUeXBlO1xuICAgICAgICAkKG9wLmNvbnRhaW5lcikucXJjb2RlKHtcbiAgICAgICAgICAgIHdpZHRoOiBvcC53aWR0aCxcbiAgICAgICAgICAgIGhlaWdodDogb3AuaGVpZ2h0LFxuICAgICAgICAgICAgdGV4dDogb3AucXJjb2RlVXJsLFxuICAgICAgICAgICAgdHlwZU51bWJlcjogMCxcbiAgICAgICAgICAgIGNvcnJlY3RMZXZlbDogMVxuICAgICAgICB9KTtcbiAgICAgICAgJChkb2N1bWVudCkuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kLnJlbW92ZUNsYXNzKCdvbicpO1xuICAgICAgICB9KTtcbiAgICAgICAgJGNvcHlVcmwuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBsZXQgYXV4ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgICAgICAgIGF1eC5zZXRBdHRyaWJ1dGUoJ3ZhbHVlJywgb3AudXJsKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYXV4KTtcbiAgICAgICAgICAgIGF1eC5zZWxlY3QoKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCdjb3B5Jyk7IC8vIOaJp+ihjOWkjeWItuWRveS7pFxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhdXgpOyAvLyDlsIYgaW5wdXQg5YWD57Sg56e76ZmkXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9wLmNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgb3AuY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChldmVudFR5cGUgPT09ICdob3ZlcicpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhvdmVyKFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAkbW9kLnRvZ2dsZUNsYXNzKCdvbicpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICRtb2QucmVtb3ZlQ2xhc3MoJ29uJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNsaWNrKGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAkbW9kLnRvZ2dsZUNsYXNzKCdvbicpO1xuICAgICAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgfTtcbn07XG4iXSwiZmlsZSI6ImpxLXBsdWdpbi5qcyJ9
