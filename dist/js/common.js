(function () {
  class Ajax {
    constructor(option) {
      this.setting = $.extend({
        baseUrl: '',
        sucHook: (url, val) => {
          return val;
        },
        errHook: () => {},
        beforeHook: () => {}
      }, option);
    }

    init(option) {
      this.setting = $.extend(this.setting, option);
    }

    urlVerify(url) {
      if (url.indexOf('http') === 0) {
        return url;
      }

      return this.setting.baseUrl + url;
    }

    get(url, op) {
      this.setting.beforeHook(url, op);

      let _url = this.urlVerify(url);

      if (op) {
        _url = _url + `?${this.parseParam(op, null)}`;
      }

      let sucHook = this.setting.sucHook;
      let errHook = this.setting.errHook;
      return new Promise((resolve, reject) => {
        $.ajax({
          url: _url,
          type: 'get',
          dataType: 'json',
          success: function (res) {
            console.log('res...', res);

            if (res.error) {
              errHook(_url, res.error);
              reject(res.error);
              return;
            } //sucHook(_url, res);


            resolve(sucHook(_url, res));
          },
          error: function (err) {
            errHook(_url, err);
            reject(err);
          }
        });
      });
    }

    post(url, param) {
      this.setting.beforeHook(url, param);

      let _url = this.urlVerify(url);

      let sucHook = this.setting.sucHook;
      let errHook = this.setting.errHook;
      return new Promise((resolve, reject) => {
        $.ajax({
          type: 'POST',
          url: _url,
          data: JSON.stringify(param),
          dataType: 'json',
          contentType: 'application/json;charset=UTF-8',
          success: function (res) {
            if (res.data_status === false) {
              errHook(_url, res.error);
              reject(res.error);
              return;
            } //sucHook(_url, res);


            resolve(sucHook(_url, res));
          },
          error: function (err) {
            errHook(_url, {
              code: err.status,
              rawMessage: err.statusText
            });
            reject(err);
          }
        });
      });
    }

    delete(url, op) {
      this.setting.beforeHook(url, op);

      let _url = this.urlVerify(url);

      if (op) {
        _url = _url + `?${this.parseParam(op, null)}`;
      }

      let sucHook = this.setting.sucHook;
      let errHook = this.setting.errHook;
      return new Promise((resolve, reject) => {
        $.ajax({
          type: 'delete',
          url: _url,
          dataType: 'json',
          success: function (res) {
            if (res.data_status === false) {
              errHook(_url, res.error);
              reject(res.error);
              return;
            }

            sucHook(_url, res);
            resolve(res);
          },
          error: function (err) {
            errHook(_url, err);
            reject(err);
          }
        });
      });
    }

    uploading(url, param) {
      this.setting.beforeHook(url, param);

      let _url = this.urlVerify(url);

      let sucHook = this.setting.sucHook;
      let errHook = this.setting.errHook;
      return new Promise((resolve, reject) => {
        $.ajax({
          type: 'POST',
          url: _url,
          data: param,
          dataType: 'json',
          processData: false,
          contentType: false,
          success: function (res) {
            if (res.data_status === false) {
              errHook(_url, res.error);
              reject(res.error);
              return;
            }

            sucHook(_url, res);
            resolve(res);
          },
          error: function (err) {
            errHook(_url, err);
            reject(err);
          }
        });
      });
    }

    parseParam(param, key) {
      let paramStr = '';

      if (typeof param === 'string' || typeof param === 'number' || typeof param === 'boolean') {
        paramStr += '&' + key + '=' + encodeURIComponent(param);
      } else if (param === null) {
        paramStr += '&' + key + '=';
      } else if (param.length) {
        $.each(param, (i, val) => {
          paramStr += '&' + key + '[]=' + encodeURIComponent(val);
        });
      } else {
        $.each(param, (i, val) => {
          let k = key === null ? i : key + ('.' + i);
          paramStr += '&' + this.parseParam(val, k);
        });
      }

      return paramStr.substr(1);
    }

  }

  window.Ajax = Ajax;
  window.ajax = new Ajax();
})(window, jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbW1vbi5lczYiXSwibmFtZXMiOlsiQWpheCIsImNvbnN0cnVjdG9yIiwib3B0aW9uIiwic2V0dGluZyIsIiQiLCJleHRlbmQiLCJiYXNlVXJsIiwic3VjSG9vayIsInVybCIsInZhbCIsImVyckhvb2siLCJiZWZvcmVIb29rIiwiaW5pdCIsInVybFZlcmlmeSIsImluZGV4T2YiLCJnZXQiLCJvcCIsIl91cmwiLCJwYXJzZVBhcmFtIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJhamF4IiwidHlwZSIsImRhdGFUeXBlIiwic3VjY2VzcyIsInJlcyIsImNvbnNvbGUiLCJsb2ciLCJlcnJvciIsImVyciIsInBvc3QiLCJwYXJhbSIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5IiwiY29udGVudFR5cGUiLCJkYXRhX3N0YXR1cyIsImNvZGUiLCJzdGF0dXMiLCJyYXdNZXNzYWdlIiwic3RhdHVzVGV4dCIsImRlbGV0ZSIsInVwbG9hZGluZyIsInByb2Nlc3NEYXRhIiwia2V5IiwicGFyYW1TdHIiLCJlbmNvZGVVUklDb21wb25lbnQiLCJsZW5ndGgiLCJlYWNoIiwiaSIsImsiLCJzdWJzdHIiLCJ3aW5kb3ciLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJBQUFBLENBQUMsWUFBVztBQUNSLFFBQU1BLElBQU4sQ0FBVztBQUNQQyxJQUFBQSxXQUFXLENBQUNDLE1BQUQsRUFBUztBQUNoQixXQUFLQyxPQUFMLEdBQWVDLENBQUMsQ0FBQ0MsTUFBRixDQUNYO0FBQ0lDLFFBQUFBLE9BQU8sRUFBRSxFQURiO0FBRUlDLFFBQUFBLE9BQU8sRUFBRSxDQUFDQyxHQUFELEVBQU1DLEdBQU4sS0FBYztBQUNuQixpQkFBT0EsR0FBUDtBQUNILFNBSkw7QUFLSUMsUUFBQUEsT0FBTyxFQUFFLE1BQU0sQ0FBRSxDQUxyQjtBQU1JQyxRQUFBQSxVQUFVLEVBQUUsTUFBTSxDQUFFO0FBTnhCLE9BRFcsRUFTWFQsTUFUVyxDQUFmO0FBV0g7O0FBRURVLElBQUFBLElBQUks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Rk0sTUFFQSxJQUFJYixLQUFLLENBQUNnQixNQUFWLEVBQWtCO0FBQ3JCNUMsUUFBQUEsQ0FBQyxDQUFDNkMsSUFBRixDQUFPakIsS0FBUCxFQUFjLENBQUNrQixDQUFELEVBQUl6QyxHQUFKLEtBQVk7QUFDdEJxQyxVQUFBQSxRQUFRLElBQUksTUFBTUQsR0FBTixHQUFZLEtBQVosR0FBb0JFLGtCQUFrQixDQUFDdEMsR0FBRCxDQUFsRDtBQUNILFNBRkQ7QUFHSCxPQUpNLE1BSUE7QUFDSEwsUUFBQUEsQ0FBQyxDQUFDNkMsSUFBRixDQUFPakIsS0FBUCxFQUFjLENBQUNrQixDQUFELEVBQUl6QyxHQUFKLEtBQVk7QUFDdEIsY0FBSTBDLENBQUMsR0FBR04sR0FBRyxLQUFLLElBQVIsR0FBZUssQ0FBZixHQUFtQkwsR0FBRyxJQUFJLE1BQU1LLENBQVYsQ0FBOUI7QUFDQUosVUFBQUEsUUFBUSxJQUFJLE1BQU0sS0FBSzVCLFVBQUwsQ0FBZ0JULEdBQWhCLEVBQXFCMEMsQ0FBckIsQ0FBbEI7QUFDSCxTQUhEO0FBSUg7O0FBQ0QsYUFBT0wsUUFBUSxDQUFDTSxNQUFULENBQWdCLENBQWhCLENBQVA7QUFDSDs7QUF4S007O0FBMktYQyxFQUFBQSxNQUFNLENBQUNyRCxJQUFQLEdBQWNBLElBQWQ7QUFDQXFELEVBQUFBLE1BQU0sQ0FBQy9CLElBQVAsR0FBYyxJQUFJdEIsSUFBSixFQUFkO0FBQ0gsQ0E5S0QsRUE4S0dxRCxNQTlLSCxFQThLV0MsTUE5S1giLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG4gICAgY2xhc3MgQWpheCB7XG4gICAgICAgIGNvbnN0cnVjdG9yKG9wdGlvbikge1xuICAgICAgICAgICAgdGhpcy5zZXR0aW5nID0gJC5leHRlbmQoXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBiYXNlVXJsOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgc3VjSG9vazogKHVybCwgdmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdmFsO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJIb29rOiAoKSA9PiB7fSxcbiAgICAgICAgICAgICAgICAgICAgYmVmb3JlSG9vazogKCkgPT4ge31cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9wdGlvblxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGluaXQob3B0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnNldHRpbmcgPSAkLmV4dGVuZCh0aGlzLnNldHRpbmcsIG9wdGlvbik7XG4gICAgICAgIH1cblxuICAgICAgICB1cmxWZXJpZnkodXJsKSB7XG4gICAgICAgICAgICBpZiAodXJsLmluZGV4T2YoJ2h0dHAnKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXR0aW5nLmJhc2VVcmwgKyB1cmw7XG4gICAgICAgIH1cblxuICAgICAgICBnZXQodXJsLCBvcCkge1xuICAgICAgICAgICAgdGhpcy5zZXR0aW5nLmJlZm9yZUhvb2sodXJsLCBvcCk7XG4gICAgICAgICAgICBsZXQgX3VybCA9IHRoaXMudXJsVmVyaWZ5KHVybCk7XG4gICAgICAgICAgICBpZiAob3ApIHtcbiAgICAgICAgICAgICAgICBfdXJsID0gX3VybCArIGA/JHt0aGlzLnBhcnNlUGFyYW0ob3AsIG51bGwpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgc3VjSG9vayA9IHRoaXMuc2V0dGluZy5zdWNIb29rO1xuICAgICAgICAgICAgbGV0IGVyckhvb2sgPSB0aGlzLnNldHRpbmcuZXJySG9vaztcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBfdXJsLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZ2V0JyxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzLi4uJywgcmVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJIb29rKF91cmwsIHJlcy5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlcy5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgLy9zdWNIb29rKF91cmwsIHJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHN1Y0hvb2soX3VybCwgcmVzKSk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVyckhvb2soX3VybCwgZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHBvc3QodXJsLCBwYXJhbSkge1xuICAgICAgICAgICAgdGhpcy5zZXR0aW5nLmJlZm9yZUhvb2sodXJsLCBwYXJhbSk7XG4gICAgICAgICAgICBsZXQgX3VybCA9IHRoaXMudXJsVmVyaWZ5KHVybCk7XG4gICAgICAgICAgICBsZXQgc3VjSG9vayA9IHRoaXMuc2V0dGluZy5zdWNIb29rO1xuICAgICAgICAgICAgbGV0IGVyckhvb2sgPSB0aGlzLnNldHRpbmcuZXJySG9vaztcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IF91cmwsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHBhcmFtKSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9VVRGLTgnLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YV9zdGF0dXMgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJySG9vayhfdXJsLCByZXMuZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXMuZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vc3VjSG9vayhfdXJsLCByZXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShzdWNIb29rKF91cmwsIHJlcykpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJIb29rKF91cmwsIHsgY29kZTogZXJyLnN0YXR1cywgcmF3TWVzc2FnZTogZXJyLnN0YXR1c1RleHQgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBkZWxldGUodXJsLCBvcCkge1xuICAgICAgICAgICAgdGhpcy5zZXR0aW5nLmJlZm9yZUhvb2sodXJsLCBvcCk7XG4gICAgICAgICAgICBsZXQgX3VybCA9IHRoaXMudXJsVmVyaWZ5KHVybCk7XG4gICAgICAgICAgICBpZiAob3ApIHtcbiAgICAgICAgICAgICAgICBfdXJsID0gX3VybCArIGA/JHt0aGlzLnBhcnNlUGFyYW0ob3AsIG51bGwpfWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgc3VjSG9vayA9IHRoaXMuc2V0dGluZy5zdWNIb29rO1xuICAgICAgICAgICAgbGV0IGVyckhvb2sgPSB0aGlzLnNldHRpbmcuZXJySG9vaztcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RlbGV0ZScsXG4gICAgICAgICAgICAgICAgICAgIHVybDogX3VybCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmRhdGFfc3RhdHVzID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVyckhvb2soX3VybCwgcmVzLmVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzLmVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWNIb29rKF91cmwsIHJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbihlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVyckhvb2soX3VybCwgZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHVwbG9hZGluZyh1cmwsIHBhcmFtKSB7XG4gICAgICAgICAgICB0aGlzLnNldHRpbmcuYmVmb3JlSG9vayh1cmwsIHBhcmFtKTtcbiAgICAgICAgICAgIGxldCBfdXJsID0gdGhpcy51cmxWZXJpZnkodXJsKTtcbiAgICAgICAgICAgIGxldCBzdWNIb29rID0gdGhpcy5zZXR0aW5nLnN1Y0hvb2s7XG4gICAgICAgICAgICBsZXQgZXJySG9vayA9IHRoaXMuc2V0dGluZy5lcnJIb29rO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICAkLmFqYXgoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgICAgIHVybDogX3VybCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogcGFyYW0sXG4gICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZGF0YV9zdGF0dXMgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJySG9vayhfdXJsLCByZXMuZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXMuZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y0hvb2soX3VybCwgcmVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJySG9vayhfdXJsLCBlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcGFyc2VQYXJhbShwYXJhbSwga2V5KSB7XG4gICAgICAgICAgICBsZXQgcGFyYW1TdHIgPSAnJztcblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIHR5cGVvZiBwYXJhbSA9PT0gJ3N0cmluZycgfHxcbiAgICAgICAgICAgICAgICB0eXBlb2YgcGFyYW0gPT09ICdudW1iZXInIHx8XG4gICAgICAgICAgICAgICAgdHlwZW9mIHBhcmFtID09PSAnYm9vbGVhbidcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHBhcmFtU3RyICs9ICcmJyArIGtleSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudChwYXJhbSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHBhcmFtID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1TdHIgKz0gJyYnICsga2V5ICsgJz0nO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJhbS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGFyYW0sIChpLCB2YWwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1TdHIgKz0gJyYnICsga2V5ICsgJ1tdPScgKyBlbmNvZGVVUklDb21wb25lbnQodmFsKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHBhcmFtLCAoaSwgdmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBrID0ga2V5ID09PSBudWxsID8gaSA6IGtleSArICgnLicgKyBpKTtcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1TdHIgKz0gJyYnICsgdGhpcy5wYXJzZVBhcmFtKHZhbCwgayk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcGFyYW1TdHIuc3Vic3RyKDEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgd2luZG93LkFqYXggPSBBamF4O1xuICAgIHdpbmRvdy5hamF4ID0gbmV3IEFqYXgoKTtcbn0pKHdpbmRvdywgalF1ZXJ5KTtcbiJdLCJmaWxlIjoiY29tbW9uLmpzIn0=
